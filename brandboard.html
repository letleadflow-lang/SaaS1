<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>AURA Brandboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600&family=Nunito:wght@300;400;500;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body,
    html {
      font-family: 'Inter', sans-serif;
      /* Keep Inter as primary */
      background: #000;
      /* Dark background for consistency */
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-size: 14px;
      overflow-x: hidden;
      /* Prevent horizontal scroll */
    }

    .font-heading {
      font-family: 'Quicksand', sans-serif;
      font-weight: 300;
      letter-spacing: -0.05em;
    }

    #shader-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: block;
      z-index: 0;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a2e4a 50%, #2e1a4a 100%);
      /* Fallback if WebGL fails */
    }

    /* Styles for hero text and aurora effects from BookEase Pro (kept for consistency, though not all may be used) */
    .hero-text {
      background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 20%, #b3e5fc 40%, #81d4fa 60%, #4fc3f7 80%, #29b6f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 80px;
      /* Adjust as needed */
      line-height: 0.9;
    }

    .aurora-text {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 25%, #a855f7 50%, #ec4899 75%, #06b6d4 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Keeping float-icon, pulse-dot, phone-float, booking-card, aurora-border, aurora-glow for potential future use or if they are part of other elements */
    .float-icon {
      animation: float-gentle 3s ease-in-out infinite;
    }

    @keyframes float-gentle {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-3px);
      }
    }

    .pulse-dot {
      animation: pulse-aurora 2s ease-in-out infinite;
    }

    @keyframes pulse-aurora {

      0%,
      100% {
        opacity: 0.6;
        transform: scale(1);
      }

      50% {
        opacity: 1;
        transform: scale(1.1);
        box-shadow: 0 0 20px currentColor;
      }
    }

    .phone-float {
      animation: phone-hover 4s ease-in-out infinite;
    }

    @keyframes phone-hover {

      0%,
      100% {
        transform: translateY(0px) rotate(0deg);
      }

      50% {
        transform: translateY(-10px) rotate(1deg);
      }
    }

    .booking-card {
      backdrop-filter: blur(12px);
      background: rgba(79, 70, 229, 0.1);
      border: 1px solid rgba(99, 102, 241, 0.2);
    }

    .aurora-border {
      position: relative;
      background: linear-gradient(45deg, #4f46e5, #7c3aed, #a855f7, #ec4899, #06b6d4);
      padding: 2px;
      border-radius: 24px;
    }

    .aurora-border>div {
      background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e3a8a 100%);
      border-radius: 22px;
    }

    .aurora-glow {
      box-shadow: 0 0 40px rgba(79, 70, 229, 0.3), 0 0 80px rgba(124, 58, 237, 0.2);
    }

    @media (max-width: 1024px) {
      .hero-text {
        font-size: 64px;
      }
    }

    @media (max-width: 768px) {
      .hero-text {
        font-size: 48px;
      }

      .phone-float {
        transform: scale(0.8);
        /* Scale down phone on smaller screens */
      }
    }

    @media (max-width: 640px) {
      .hero-text {
        font-size: 40px;
      }

      .phone-float {
        transform: scale(0.7);
        /* Further scale down phone on mobile */
      }
    }

    /* Custom styles for the step indicators */
    .step-indicator.active {
      background-color: #06b6d4;
      /* Tailwind cyan-500 */
      color: white;
      font-weight: 600;
    }

    .step-indicator.completed {
      background-color: #16a34a;
      /* Tailwind green-600 */
      color: white;
    }

    .step-indicator {
      transition: background-color 0.3s ease, color 0.3s ease;
    }
  </style>
</head>

<body class="font-['Inter'] bg-gray-900 overflow-x-hidden">

  <!-- Animated Background -->
  <canvas id="shader-canvas"></canvas>

  <!-- Brandboard Content Section -->
  <section class="relative z-10 min-h-screen flex items-center justify-center pt-12 pb-12 px-6">
    <div class="max-w-4xl text-center mx-auto">
      <h1 class="text-5xl md:text-6xl font-bold text-white tracking-tighter mb-6">
        Your <span
          class="bg-clip-text text-transparent bg-gradient-to-br from-purple-500 via-pink-500 to-rose-500">Brandboard</span>
      </h1>
      <p class="text-xl text-gray-300 leading-relaxed mb-8">
        Define your brand's core identity, visual style, and messaging.
      </p>

      <p class="text-xl text-gray-300 leading-relaxed mb-8">
        There are 3 steps to building your brand board.
      </p>

      <!-- Process Bar -->
      <div class="flex justify-between items-center max-w-2xl mx-auto mb-8 bg-gray-700/50 rounded-full p-1">
        <div id="stepIndicator1"
          class="step-indicator flex-1 text-center py-2 px-4 rounded-full bg-cyan-600 text-white transition-all duration-300">
          Brand Voice</div>
        <div class="w-8 h-1 bg-gray-600 mx-2 rounded-full"></div>
        <div id="stepIndicator2"
          class="step-indicator flex-1 text-center py-2 px-4 rounded-full text-gray-400 transition-all duration-300">
          Typography</div>
        <div class="w-8 h-1 bg-gray-600 mx-2 rounded-full"></div>
        <div id="stepIndicator3"
          class="step-1 flex-1 text-center py-2 px-4 rounded-full text-gray-400 transition-all duration-300">Imagery
        </div>
      </div>

      <div class="bg-gray-800/60 border border-gray-700/50 rounded-xl p-8 backdrop-blur-sm shadow-lg text-left">
        <!-- Step 1: Brand Voice -->
        <div id="stepContent1" class="step-content">
          <h2 class="text-3xl font-semibold text-white mb-4">Brand Voice</h2>
          <p class="text-gray-400 mb-6">First, let's define your brand's core identity.</p>

          <div class="mb-6">
            <label for="logoUpload" class="block text-gray-300 text-lg font-medium mb-2">Upload Your Logo <span
                class="text-red-500">*</span></label>
            <input type="file" id="logoUpload" accept="image/*"
              class="w-full text-gray-300 bg-gray-700/50 border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors">
            <p class="text-gray-500 text-sm mt-1">This is a necessary step.</p>
          </div>

          <div class="mb-6">
            <label for="brandStory" class="block text-gray-300 text-lg font-medium mb-2">Brand Story & Mission:</label>
            <p class="text-gray-400 text-sm mb-2">Why did you start this business? What problem are you solving? What is
              your core mission?</p>
            <textarea id="brandStory"
              class="w-full min-h-[100px] max-h-48 resize-y bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
          </div>

          <div class="mb-6">
            <label for="brandPersonality" class="block text-gray-300 text-lg font-medium mb-2">Brand Personality &
              Values:</label>
            <p class="text-gray-400 text-sm mb-2">Describe your brand's personality (e.g., professional, friendly,
              innovative). What are your core values?</p>
            <textarea id="brandPersonality"
              class="w-full min-h-[100px] max-h-48 resize-y bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
          </div>

          <div class="mb-6">
            <label for="targetAudience" class="block text-gray-300 text-lg font-medium mb-2">Target Audience:</label>
            <p class="text-gray-400 text-sm mb-2">Who is your target audience? What are their frustrations? How do you
              want them to feel?</p>
            <textarea id="targetAudience"
              class="w-full min-h-[100px] max-h-48 resize-y bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
          </div>

          <div class="mb-0">
            <label for="brandVoiceMessaging" class="block text-gray-300 text-lg font-medium mb-2">Brand Voice &
              Messaging:</label>
            <p class="text-gray-400 text-sm mb-2">What tone of voice do you want (e.g., formal, casual)? What key
              phrases are associated with your brand?</p>
            <textarea id="brandVoiceMessaging"
              class="w-full min-h-[100px] max-h-48 resize-y bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
          </div>
        </div>

        <!-- Step 2: Typography -->
        <div id="stepContent2" class="step-content hidden">
          <h2 class="text-3xl font-semibold text-white mb-4">Typography</h2>
          <p class="text-gray-400 mb-6">Next, let's define the fonts and textual style for your brand.</p>

          <div class="mb-6">
            <label for="fontFeeling" class="block text-gray-300 text-lg font-medium mb-2">What kind of feeling do you
              want the fonts to convey?</label>
            <p class="text-gray-400 text-sm mb-2">e.g., modern, classic, elegant, friendly, professional, minimalist.
            </p>
            <textarea id="fontFeeling"
              class="w-full min-h-[100px] max-h-48 resize-y bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
          </div>

          <div class="mb-6">
            <label for="existingFonts" class="block text-gray-300 text-lg font-medium mb-2">Do you have any fonts in
              mind already?</label>
            <p class="text-gray-400 text-sm mb-2">Maybe a font you've seen and liked, or a specific style you prefer?
            </p>
            <textarea id="existingFonts"
              class="w-full min-h-[100px] max-h-48 resize-y bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
          </div>

          <div class="mb-0">
            <label for="fontImagesUpload" class="block text-gray-300 text-lg font-medium mb-2">Upload font images you
              like (Optional)</label>
            <input type="file" id="fontImagesUpload" accept="image/*"
              class="w-full text-gray-300 bg-gray-700/50 border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors">
          </div>
        </div>

        <!-- Step 3: Imagery and Photography Style -->
        <div id="stepContent3" class="step-content hidden">
          <h2 class="text-3xl font-semibold text-white mb-4">Imagery and Photography Style</h2>
          <p class="text-gray-400 mb-6">Finally, let's define the visual aesthetic of your brand's imagery.</p>

          <div class="mb-6">
            <label for="moodFeeling" class="block text-gray-300 text-lg font-medium mb-2">What overall mood or feeling
              do you want your photos to convey?</label>
            <p class="text-gray-400 text-sm mb-2">Think of adjectives like: bright, moody, clean, organic, authentic,
              professional, or candid.</p>
            <textarea id="moodFeeling"
              class="w-full min-h-[100px] max-h-48 resize-y bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
          </div>

          <div class="mb-6">
            <label for="subjectFeatures" class="block text-gray-300 text-lg font-medium mb-2">What types of subjects
              should be featured in your imagery?</label>
            <p class="text-gray-400 text-sm mb-2">e.g., people, families, homes, architectural details, abstract
              patterns, nature.</p>
            <textarea id="subjectFeatures"
              class="w-full min-h-[100px] max-h-48 resize-y bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
          </div>

          <div class="mb-6">
            <label for="photoStyles" class="block text-gray-300 text-lg font-medium mb-2">Are there any specific photo
              styles you like or dislike?</label>
            <p class="text-gray-400 text-sm mb-2">e.g., minimalist with white space, or textured and detailed.</p>
            <textarea id="photoStyles"
              class="w-full min-h-[100px] max-h-48 resize-y bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors"></textarea>
          </div>

          <div class="mb-0">
            <label for="inspirationImagesUpload" class="block text-gray-300 text-lg font-medium mb-2">Upload inspiration
              photos (Optional)</label>
            <input type="file" id="inspirationImagesUpload" accept="image/*"
              class="w-full text-gray-300 bg-gray-700/50 border-gray-600/50 border rounded-lg py-3 px-4 focus:outline-none focus:border-cyan-500 transition-colors">
          </div>
        </div>

        <div id="messageBox" class="text-center text-red-400 mb-2 h-6 mt-4"></div>

        <!-- Navigation Buttons -->
        <div class="flex justify-end mt-8">
          <button id="prevStepBtn"
            class="px-6 py-3 rounded-full bg-gray-700 text-gray-300 hover:bg-gray-600 transition-colors mr-4 hidden">Previous</button>
          <button id="nextStepBtn"
            class="px-6 py-3 rounded-full bg-gradient-to-br from-purple-500 to-rose-500 text-white font-medium hover:opacity-80 transition-opacity">Next</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Login/Signup Modal Pop-up (Copied from homepage) -->
  <div id="loginModal" class="modal-overlay hidden">
    <div class="modal-content">
      <span id="closeModalBtn" class="modal-close-btn">×</span>
      <h2 class="text-3xl font-bold text-white mb-6"></h2> <!-- Title updated dynamically -->
      <p class="text-gray-300 mb-6" id="modalDescription"></p> <!-- Description updated dynamically -->

      <div id="modalMessageBox" class="text-center text-red-400 mb-6"></div>

      <!-- Login Form -->
      <div id="loginForm">
        <input type="email" id="modalEmail" placeholder="Email"
          class="w-full bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 mb-4 focus:outline-none focus:border-cyan-500 transition-colors">
        <input type="password" id="modalPassword" placeholder="Password"
          class="w-full bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 mb-6 focus:outline-none focus:border-cyan-500 transition-colors">

        <button id="modalLoginBtn"
          class="w-full px-6 py-3 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white font-medium hover:opacity-80 transition-opacity">Log
          In</button>
        <a href="#" id="switchToSignup" class="toggle-link">Don't have an account? Sign Up</a>
      </div>

      <!-- Signup Form (Hidden by default) -->
      <div id="signupForm" class="hidden">
        <input type="email" id="modalSignupEmail" placeholder="Email"
          class="w-full bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 mb-4 focus:outline-none focus:border-cyan-500 transition-colors">
        <input type="password" id="modalSignupPassword" placeholder="Password"
          class="w-full bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 mb-4 focus:outline-none focus:border-cyan-500 transition-colors">
        <input type="text" id="modalFirstName" placeholder="First Name"
          class="w-full bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 mb-4 focus:outline-none focus:border-cyan-500 transition-colors">
        <input type="text" id="modalLastName" placeholder="Last Name"
          class="w-full bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 mb-4 focus:outline-none focus:border-cyan-500 transition-colors">
        <input type="text" id="modalBusinessName" placeholder="Business Name (Optional)"
          class="w-full bg-gray-700/50 text-white border-gray-600/50 border rounded-lg py-3 px-4 mb-6 focus:outline-none focus:border-cyan-500 transition-colors">

        <button id="modalSignupBtn"
          class="w-full px-6 py-3 rounded-full bg-gray-700/50 text-gray-300 border border-gray-600/50 hover:border-cyan-500 hover:text-white transition-all">Sign
          Up</button>
        <a href="#" id="switchToLogin" class="toggle-link">Already have an account? Log In</a>
      </div>
    </div>
  </div>

  <script type="module">
    // Supabase client import
    import {createClient} from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // Your Supabase project details
    const SUPABASE_URL = 'https://nlmnoxltgkitddcsfvvi.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sbW5veGx0Z2tpdGRkY3NmdnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MDA0ODcsImV4cCI6MjA2OTk3NjQ4N30.-zSVI3pAJoF8NOSjE_Ell46_xhXyMF3N_NojPJ0xFO0';

    // Initialize Supabase client
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Expose supabase object globally for easier access if needed
    window.supabase = supabase;

    // Get header elements (these are no longer present, but variables are kept for consistency if they were to be re-added)
    const loginToggleButton = null; // document.getElementById('loginToggleButton');
    const loginStatusElement = null; // document.getElementById('loginStatus');

    // Get modal elements
    const loginModal = document.getElementById('loginModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const modalMessageBox = document.getElementById('modalMessageBox'); // This is the message box inside the modal
    const modalTitle = document.querySelector('#loginModal h2');
    const modalDescription = document.getElementById('modalDescription');

    // Login Form elements
    const loginForm = document.getElementById('loginForm');
    const modalEmailInput = document.getElementById('modalEmail');
    const modalPasswordInput = document.getElementById('modalPassword');
    const modalLoginBtn = document.getElementById('modalLoginBtn');
    const switchToSignupLink = document.getElementById('switchToSignup');

    // Signup Form elements
    const signupForm = document.getElementById('signupForm');
    const modalSignupEmailInput = document.getElementById('modalSignupEmail');
    const modalSignupPasswordInput = document.getElementById('modalSignupPassword');
    const modalFirstNameInput = document.getElementById('modalFirstName');
    const modalLastNameInput = document.getElementById('modalLastName');
    const modalBusinessNameInput = document.getElementById('modalBusinessName');
    const modalSignupBtn = document.getElementById('modalSignupBtn');
    const switchToLoginLink = document.getElementById('switchToLogin');

    // Function to show/hide the modal and set initial form
    function showLoginModal(formType = 'login') {
      console.log('showLoginModal called, type:', formType);
      if (loginModal) {
        loginModal.classList.remove('hidden');
        modalMessageBox.textContent = ''; // Clear message on open
        if (formType === 'signup') {
          showSignupForm();
        } else {
          showLoginForm();
        }
      }
    }

    function hideLoginModal() {
      console.log('hideLoginModal called');
      if (loginModal) {
        loginModal.classList.add('hidden');
      }
    }

    // Functions to switch between forms
    function showLoginForm() {
      console.log('showLoginForm called');
      if (loginForm && signupForm && modalTitle && modalDescription) {
        loginForm.classList.remove('hidden');
        signupForm.classList.add('hidden');
        modalTitle.textContent = 'Log In';
        modalDescription.textContent = 'Please log in to send prompts.';
        // Clear login fields
        modalEmailInput.value = '';
        modalPasswordInput.value = '';
        modalMessageBox.textContent = '';
      }
    }

    function showSignupForm() {
      console.log('showSignupForm called');
      if (loginForm && signupForm && modalTitle && modalDescription) {
        loginForm.classList.add('hidden');
        signupForm.classList.remove('hidden');
        modalTitle.textContent = 'Sign Up';
        modalDescription.textContent = 'Create an account to send prompts.';
        // Clear signup fields
        modalSignupEmailInput.value = '';
        modalSignupPasswordInput.value = '';
        modalFirstNameInput.value = '';
        modalLastNameInput.value = '';
        modalBusinessNameInput.value = '';
        modalMessageBox.textContent = '';
      }
    }

    // Handle initial login/logout from header button (this button is removed)
    // The authentication check for proceeding with the form will still trigger the modal.
    const handleAuthToggle = async () => {
      console.log('handleAuthToggle called (header button removed)');
      const {data: {session}} = await supabase.auth.getSession();
      if (session) {
        console.log('User is logged in, attempting to log out...');
        try {
          const {error} = await supabase.auth.signOut();
          if (error) {
            console.error('Logout error:', error.message);
          } else {
            console.log('User logged out successfully');
          }
        } catch (error) {
          console.error('Unexpected error during logout:', error.message);
        }
      } else {
        console.log('User is not logged in, showing login modal...');
        showLoginModal('login');
      }
    };

    // Listen for authentication state changes and update UI
    supabase.auth.onAuthStateChange(async (event, session) => {
      console.log('Auth state changed event:', event, 'session:', session);
      const user = session?.user;
      if (user) {
        console.log('User is authenticated:', user.id);
        // loginToggleButton and loginStatusElement are now null, so these lines won't execute
        // if (loginToggleButton) loginToggleButton.textContent = 'Logout';
        // const displayName = user.user_metadata?.first_name || user.email || user.id;
        // if (loginStatusElement) loginStatusElement.textContent = `Welcome, ${displayName}`;
        hideLoginModal();

        // This redirection logic is specific to the homepage.
        // On the brandboard, we only want to ensure the user is logged in to proceed with the form.
        // if (event === 'SIGNED_IN' && window.location.pathname === '/') {
        //   console.log('User signed in on homepage, checking profile for redirection...');
        //   const { data: profileData, error: profileError } = await supabase
        //     .from('user_profiles')
        //     .select('id')
        //     .eq('id', user.id);

        //   if (profileError) {
        //     console.error('Error fetching user profile:', profileError.message);
        //   } else if (!profileData || profileData.length === 0) {
        //     console.log("User profile not found, redirecting to brandboard.");
        //     window.location.href = window.location.origin + '/brandboard';
        //   } else {
        //     console.log("User profile found, no redirection needed from homepage.");
        //   }
        // }

      } else {
        console.log('User is not authenticated.');
        // loginToggleButton and loginStatusElement are now null, so these lines won't execute
        // if (loginToggleButton) loginToggleButton.textContent = 'Login';
        // if (loginStatusElement) loginStatusElement.textContent = '';
      }
      // Ensure send button state is updated after auth change
      // This function is not relevant to the brandboard page as it doesn't have a "send" button
      // if (typeof updateSendButtonState === 'function') {
      //   updateSendButtonState();
      // }
    });

    // Add click listener to the header button (removed)
    // if (loginToggleButton) {
    //   loginToggleButton.addEventListener('click', handleAuthToggle);
    //   console.log('loginToggleButton event listener added.');
    // } else {
    //   console.warn('loginToggleButton not found on page load.');
    // }

    // --- Modal Authentication Logic ---
    if (closeModalBtn) {
      closeModalBtn.addEventListener('click', hideLoginModal);
      console.log('closeModalBtn event listener added.');
    } else {
      console.warn('closeModalBtn not found on page load.');
    }

    // Toggle links
    if (switchToSignupLink) {
      switchToSignupLink.addEventListener('click', (e) => {
        e.preventDefault();
        showSignupForm();
      });
      console.log('switchToSignupLink event listener added.');
    } else {
      console.warn('switchToSignupLink not found on page load.');
    }
    if (switchToLoginLink) {
      switchToLoginLink.addEventListener('click', (e) => {
        e.preventDefault();
        showLoginForm();
      });
      console.log('switchToLoginLink event listener added.');
    } else {
      console.warn('switchToLoginLink not found on page load.');
    }

    if (modalLoginBtn) {
      modalLoginBtn.addEventListener('click', async () => {
        console.log('Modal Login button clicked. Attempting signInWithPassword...');
        const email = modalEmailInput.value;
        const password = modalPasswordInput.value;
        const {data, error} = await supabase.auth.signInWithPassword({email, password});
        if (error) {
          console.error('Supabase signInWithPassword error:', error.message, error.status);
          modalMessageBox.textContent = `Login Error: ${error.message}`;
          modalMessageBox.classList.remove('text-green-400');
          modalMessageBox.classList.add('text-red-400');
        } else {
          console.log('Supabase signInWithPassword successful:', data);
          modalMessageBox.textContent = 'Login successful!';
          modalMessageBox.classList.remove('text-red-400');
          modalMessageBox.classList.add('text-green-400');
          // onAuthStateChange will handle hiding the modal and updating header status
        }
      });
      console.log('modalLoginBtn event listener added.');
    } else {
      console.warn('modalLoginBtn not found on page load.');
    }

    if (modalSignupBtn) {
      modalSignupBtn.addEventListener('click', async () => {
        console.log('Modal Signup button clicked. Attempting signUp...');
        const email = modalSignupEmailInput.value;
        const password = modalSignupPasswordInput.value;
        const firstName = modalFirstNameInput.value;
        const lastName = modalLastNameInput.value;
        const businessName = modalBusinessNameInput.value;

        // Basic validation for required signup fields
        if (!email || !password || !firstName || !lastName) {
          console.warn('Signup validation failed: Missing required fields.');
          modalMessageBox.textContent = 'Email, Password, First Name, and Last Name are required.';
          modalMessageBox.classList.remove('text-green-400');
          modalMessageBox.classList.add('text-red-400');
          return;
        }

        // Prepare user_metadata for auth.users table
        const userMetadata = {
          first_name: firstName,
          last_name: lastName,
          business_name: businessName || null
        };

        const {data: signUpData, error: signUpError} = await supabase.auth.signUp({
          email,
          password,
          options: {
            data: userMetadata
          }
        });

        if (signUpError) {
          console.error('Supabase signUp error:', signUpError.message, signUpError.status);
          modalMessageBox.textContent = `Signup Error: ${signUpError.message}`;
          modalMessageBox.classList.remove('text-green-400');
          modalMessageBox.classList.add('text-red-400');
        } else {
          console.log('Supabase signUp successful:', signUpData);
          // If signup is successful and a user object is returned (for immediate sign-in, or after email confirmation)
          if (signUpData.user) {
            console.log('User signed up and immediately logged in, attempting to insert profile...');
            // Insert user profile data into the 'user_profiles' table
            const {error: insertError} = await supabase
              .from('user_profiles')
              .insert([
                {
                  id: signUpData.user.id, // Link to auth.users.id
                  first_name: firstName,
                  last_name: lastName,
                  business_name: businessName || null
                }
              ]);

            if (insertError) {
              console.error('Error inserting user profile:', insertError.message);
              modalMessageBox.textContent = `Sign up successful, but profile creation failed: ${insertError.message}. Please check your email to confirm.`;
              modalMessageBox.classList.remove('text-green-400');
              modalMessageBox.classList.add('text-red-400');
            } else {
              console.log('User profile inserted successfully.');
              modalMessageBox.textContent = 'Sign up successful! Please check your email to confirm.';
              modalMessageBox.classList.remove('text-red-400');
              modalMessageBox.classList.add('text-green-400');
            }
          } else {
            console.log('User signed up, but email confirmation is likely required.');
            // This path is taken if email confirmation is required and user is not immediately signed in
            modalMessageBox.textContent = 'Sign up successful! Please check your email to confirm.';
            modalMessageBox.classList.remove('text-red-400');
            modalMessageBox.classList.add('text-green-400');
          }
        }
      });
      console.log('modalSignupBtn event listener added.');
    } else {
      console.warn('modalSignupBtn not found on page load.');
    }

    window.addEventListener('load', function () {
      const canvas = document.getElementById('shader-canvas');
      const gl = canvas ? canvas.getContext('webgl') : null;

      if (!gl) {
        console.error("WebGL not supported, falling back to CSS background.");
        return;
      }

      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
      }
      resize();
      window.addEventListener('resize', resize);

      const vertexShaderSource = `
            attribute vec2 aPosition;
            void main() {
                gl_Position = vec4(aPosition, 0.0, 1.0);
            }
        `;
      const fragmentShaderSource = `
            precision highp float;
            uniform float iTime;
            uniform vec2 iResolution;

            float noise(vec2 p) {
                return fract(sin(dot(p.xy, vec2(12.9898, 78.233))) * 43758.5453);
            }

            void main() {
                vec2 uv = gl_FragCoord.xy / iResolution.xy;
                float n = noise(uv * 200.0 + iTime * 1.5) * 0.03;
                float dist = length(uv - 0.5);
                float vignette = 1.0 - smoothstep(0.3, 1.0, dist);

                vec3 color = vec3(0.08, 0.1, 0.25);

                float wave1 = sin(iTime * 0.5 + uv.x * 3.0 + uv.y * 2.0) * 0.5 + 0.5;
                float wave2 = sin(iTime * 0.3 + uv.x * 2.0 - uv.y * 3.0) * 0.5 + 0.5;

                color += vec3(0.2, 0.1, 0.4) * wave1 * 0.3;
                color += vec3(0.1, 0.3, 0.6) * wave2 * 0.2;
                color += vec3(0.4, 0.2, 0.6) * (sin(iTime * 0.2 + uv.y * 4.0) * 0.3 + 0.3) * 0.2;

                color += n;
                color *= vignette;

                gl_FragColor = vec4(color, 1.0);
            }
        `;
      function compileShader(type, source) {
        const shader = gl.createShader(type);
        gl.shaderSource(shader, source);
        gl.compileShader(shader);
        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
          console.error('Shader compile error:', gl.getShaderInfoLog(shader));
        }
        return shader;
      }
      const vertexShader = compileShader(gl.VERTEX_SHADER, vertexShaderSource);
      const fragmentShader = compileShader(gl.FRAGMENT_SHADER, fragmentShaderSource);
      const program = gl.createProgram();
      gl.attachShader(program, vertexShader);
      gl.attachShader(program, fragmentShader);
      gl.linkProgram(program);
      if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
        console.error('Program link error:', gl.getProgramInfoLog(program));
      }
      gl.useProgram(program);
      const buffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
        -1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1,
      ]), gl.STATIC_DRAW);
      const aPosition = gl.getAttribLocation(program, 'aPosition');
      gl.enableVertexAttribArray(aPosition);
      gl.vertexAttribPointer(aPosition, 2, gl.FLOAT, false, 0, 0);
      const iTimeLoc = gl.getUniformLocation(program, 'iTime');
      const iResLoc = gl.getUniformLocation(program, 'iResolution');
      function render(time) {
        gl.uniform1f(iTimeLoc, time * 0.001);
        gl.uniform2f(iResLoc, canvas.width, canvas.height);
        gl.drawArrays(gl.TRIANGLES, 0, 6);
        requestAnimationFrame(render);
      }
      requestAnimationFrame(render);
    });

    document.addEventListener('DOMContentLoaded', () => {
      // It's important to call this after all elements are guaranteed to be in the DOM
      // and after Supabase auth state is potentially resolved.
      // A small timeout helps ensure all elements are rendered.
      setTimeout(window.updateSendButtonState, 100);
    });
  </script>

</body>

</html>